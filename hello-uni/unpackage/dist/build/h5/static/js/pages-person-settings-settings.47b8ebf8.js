(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-person-settings-settings"],{5081:function(e,t,n){"use strict";(function(e){var o=n("4ea4");n("4160"),n("b64b"),n("ac1f"),n("1276"),n("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.store=t.mutations=void 0,n("96cf");var a=o(n("1da1")),i=o(n("388a")),r=o(n("e143")),u=e.importObject("uni-id-co"),s=e.database(),c=s.collection("uni-id-users"),l=uni.getStorageSync("uni-id-pages-userInfo")||{};console.log(l);var d={userInfo:l,hasLogin:0!=Object.keys(l).length};console.log("data",d);var f={updateUserInfo:function(){var e=arguments,t=this;return(0,a.default)(regeneratorRuntime.mark((function n(){var o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.length>0&&void 0!==e[0]&&e[0],!o){n.next=5;break}c.where("_id==$env.uid").update(o).then((function(e){console.log(e),e.result.updated?(uni.showToast({title:"更新成功",icon:"none"}),t.setUserInfo(o)):uni.showToast({title:"没有改变",icon:"none"})})),n.next=17;break;case 5:return n.prev=5,n.next=8,c.where("'_id' == $cloudEnv_uid").field("mobile,nickname,user_name,email,avatar_file").get();case 8:a=n.sent,console.log("fromDbData",a.result.data),t.setUserInfo(a.result.data[0]),n.next=17;break;case 13:n.prev=13,n.t0=n["catch"](5),t.setUserInfo({},{cover:!0}),console.error(n.t0.message,n.t0.errCode);case 17:case"end":return n.stop()}}),n,null,[[5,13]])})))()},setUserInfo:function(e){var t=arguments;return(0,a.default)(regeneratorRuntime.mark((function n(){var o,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=t.length>1&&void 0!==t[1]?t[1]:{cover:!1},a=o.cover,console.log("set-userInfo",e),i=a?e:Object.assign(g.userInfo,e),g.userInfo=Object.assign({},i),g.hasLogin=0!=Object.keys(g.userInfo).length,console.log("store.userInfo",g.userInfo),uni.setStorage({key:"uni-id-pages-userInfo",data:g.userInfo}),n.abrupt("return",e);case 8:case"end":return n.stop()}}),n)})))()},logout:function(){var e=this;return(0,a.default)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u.logout();case 2:uni.removeStorageSync("uni_id_token"),uni.setStorageSync("uni_id_token_expired",0),uni.redirectTo({url:"/".concat(null!==(n=null===(o=i.default.uniIdRouter)||void 0===o?void 0:o.loginPage)&&void 0!==n?n:"uni_modules/uni-id-pages/pages/login/login-withoutpwd")}),uni.$emit("uni-id-pages-logout"),e.setUserInfo({},{cover:!0});case 7:case"end":return t.stop()}}),t)})))()},loginSuccess:function(e){var t=e.showToast,n=void 0===t||t,o=e.toastText,a=void 0===o?"登录成功":o,r=e.autoBack,u=void 0===r||r,s=e.uniIdRedirectUrl,c=void 0===s?"":s;if(console.log({toastText:a,autoBack:u}),n&&uni.showToast({title:a,icon:"none"}),this.updateUserInfo(),uni.$emit("uni-id-pages-login-success"),u){var l=0,d=getCurrentPages();if(d.forEach((function(e,t){"login"==d[d.length-t-1].route.split("/")[3]&&l++})),console.log("判断需要返回几层:",d,l),c)return uni.reLaunch({url:c});if("weixin"==e.loginType)return console.log("window.history",window.history),window.history.go(-3);if(l){var f=i.default.pages[0];return uni.reLaunch({url:"/".concat(f.path)})}uni.navigateBack({delta:l})}}};t.mutations=f;var g=r.default.observable(d);t.store=g}).call(this,n("a9ff")["default"])},"52d6":function(e,t,n){"use strict";n.r(t);var o=n("e992"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=a.a},a1cd:function(e,t,n){"use strict";var o=n("f6b4"),a=n.n(o);a.a},c950:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o}));var o={uniList:n("1303").default,uniListItem:n("6d6b").default},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"content"},[n("uni-list",{staticClass:"mt10",attrs:{border:!1}},[n("uni-list-item",{attrs:{title:"个人资料",to:"/uni_modules/uni-id-pages/pages/userinfo/userinfo",link:"navigateTo"}}),n("uni-list-item",{attrs:{title:"注销账号"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.deactivate.apply(void 0,arguments)}}})],1),n("v-uni-view",{staticClass:"bottom-back"},[e.hasLogin?n("v-uni-text",{staticClass:"bottom-back-text"},[e._v("退出")]):n("v-uni-text",{staticClass:"bottom-back-text",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.login.apply(void 0,arguments)}}},[e._v("登录")])],1)],1)},i=[]},e992:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("5081"),a={data:function(){return{}},computed:{userInfo:function(){return console.log("store.userInfo",o.store.userInfo),o.store.userInfo},hasLogin:function(){return console.log("store.hasLogin",o.store.hasLogin),o.store.hasLogin}},methods:{login:function(){uni.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd",complete:function(e){console.log(e)}})},logout:function(){o.mutations.logout()},deactivate:function(){uni.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/deactivate/deactivate"})}}};t.default=a},edd6:function(e,t,n){"use strict";n.r(t);var o=n("c950"),a=n("52d6");for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("a1cd");var r,u=n("f0c5"),s=Object(u["a"])(a["default"],o["b"],o["c"],!1,null,"0ea58e8a",null,!1,o["a"],r);t["default"]=s.exports},f6b4:function(e,t,n){var o=n("fd0f");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("4f06").default;a("798b0284",o,!0,{sourceMap:!1,shadowMode:!1})},fd0f:function(e,t,n){var o=n("24fb");t=o(!1),t.push([e.i,"\nuni-page-body[data-v-0ea58e8a]{flex:1;width:100%;height:100%}uni-button[data-v-0ea58e8a]:after{border:none;border-radius:0}\n.content[data-v-0ea58e8a]{\ndisplay:flex;width:%?750?%;height:100vh;\nflex-direction:column;flex:1;background-color:#f9f9f9}.bottom-back[data-v-0ea58e8a]{margin-top:10px;width:%?750?%;height:44px;\ndisplay:flex;\nflex-direction:column;justify-content:center;align-items:center;\nborder:none;\nborder-width:0;border-radius:0;background-color:#fff}.bottom-back-text[data-v-0ea58e8a]{font-size:%?33?%}.mt10[data-v-0ea58e8a]{margin-top:10px}\n.content[data-v-0ea58e8a]  .uni-list{background-color:#f9f9f9}.content[data-v-0ea58e8a]  .uni-list-item--disabled,.list-item[data-v-0ea58e8a]{height:50px;margin-bottom:1px}\n",""]),e.exports=t}}]);